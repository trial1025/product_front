import{L as x,M as C,K as v,x as m,A as b,P as u,R as w,S as e,a2 as B,c as o,Q as f,a1 as h,V as P,J as S,a5 as A}from"./index-ca79e1a9.js";import{V as D}from"./VContainer-48439a55.js";import{V as _}from"./VCol-48ed8392.js";import{V as R}from"./VDivider-f57fd27d.js";import{V as q}from"./VDataTable-635b4e1b.js";import{V as I}from"./VRow-7f0ebc87.js";import"./VList-604e7688.js";import"./VListItem-92849be7.js";import"./VMenu-6da29fbd.js";const L=A("h1",null,"追蹤清單",-1),M={key:0},N={key:1,class:"text-red text-decoration-line-through"},G={__name:"CartView",setup(j){const{apiAuth:d}=B(),l=x(),p=C(),g=v(),a=m([]),k=[{title:"圖片",key:"product.image"},{title:"商品名稱",key:"product.name"},{title:"賣家",key:"product.account"},{title:"單價",key:"product.price"},{title:"追蹤",key:"action"}],y=async(s,r)=>{var t,n;if(!p.isLogin){g.push("/login");return}try{const{data:c}=await d.patch("/users/cart",{product:s,quantity:r});p.cart=c.result,l({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}});const i=a.value.findIndex(V=>V.product._id===s);a.value[i].quantity+=r,a.value[i].quantity<=0&&a.value.splice(i,1)}catch(c){console.log(c);const i=((n=(t=c==null?void 0:c.response)==null?void 0:t.data)==null?void 0:n.message)||"發生錯誤，請稍後再試";l({text:i,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return m(!1),b(async()=>{var s,r;try{const{data:t}=await d.get("/users/cart");a.value.push(...t.result)}catch(t){console.log(t);const n=((r=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:r.message)||"發生錯誤，請稍後再試";l({text:n,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),(s,r)=>(u(),w(D,{"d-flex":""},{default:e(()=>[o(I,{justify:"center",align:"center"},{default:e(()=>[o(_,{cols:"8"},{default:e(()=>[L]),_:1}),o(R),o(_,{cols:"8"},{default:e(()=>[o(q,{items:a.value,headers:k},{"item.product.name":e(({item:t})=>[t.product.sell?(u(),f("span",M,h(t.product.name),1)):(u(),f("span",N,h(t.product.name)+" (已下架)",1))]),"item.product.image":e(({item:t})=>[o(P,{src:t.product.image,height:"100px"},null,8,["src"])]),"item.action":e(({item:t})=>[o(S,{variant:"text",icon:"mdi-heart",color:"primary",onClick:n=>y(t.product._id,t.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1})]),_:1})]),_:1}))}};export{G as default};
