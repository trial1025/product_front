import{L as V,M as v,K as x,x as C,A as b,P as u,R as w,S as e,a2 as B,c as o,Q as m,a1 as f,V as P,J as S,a5 as q}from"./index-2c4a6ffb.js";import{V as A}from"./VContainer-6b33fd8a.js";import{V as h}from"./VCol-8d971aba.js";import{V as D}from"./VDivider-800c7117.js";import{V as R}from"./VDataTable-7c2dfd89.js";import{V as I}from"./VRow-3907badf.js";import"./VList-40395055.js";import"./VListItem-175be58e.js";import"./VMenu-33db0c7d.js";const L=q("h1",null,"追蹤清單",-1),M={key:0},N={key:1,class:"text-red text-decoration-line-through"},G={__name:"CartView",setup(j){const{apiAuth:d}=B(),l=V(),p=v(),_=x(),a=C([]),y=[{title:"圖片",key:"product.image"},{title:"商品名稱",key:"product.name"},{title:"賣家",key:"product.account"},{title:"單價",key:"product.price"},{title:"追蹤",key:"action"}],g=async(s,c)=>{var t,n;if(!p.isLogin){_.push("/login");return}try{const{data:r}=await d.patch("/users/favorite",{product:s});p.favorite=r.result,l({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}});const i=a.value.findIndex(k=>k.product._id===s);a.value[i].quantity+=c,a.value[i].quantity<=0&&a.value.splice(i,1)}catch(r){console.log(r);const i=((n=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:n.message)||"發生錯誤，請稍後再試";l({text:i,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return b(async()=>{var s,c;try{const{data:t}=await d.get("/users/favorite");a.value.push(...t.result)}catch(t){console.log(t);const n=((c=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:c.message)||"發生錯誤，請稍後再試";l({text:n,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),(s,c)=>(u(),w(A,{"d-flex":""},{default:e(()=>[o(I,{justify:"center",align:"center"},{default:e(()=>[o(h,{cols:"8"},{default:e(()=>[L]),_:1}),o(D),o(h,{cols:"8"},{default:e(()=>[o(R,{items:a.value,headers:y},{"item.product.name":e(({item:t})=>[t.product.sell?(u(),m("span",M,f(t.product.name),1)):(u(),m("span",N,f(t.product.name)+" (已下架)",1))]),"item.product.image":e(({item:t})=>[o(P,{src:t.product.image,height:"100px"},null,8,["src"])]),"item.action":e(({item:t})=>[o(S,{variant:"text",icon:"mdi-heart",color:"primary",onClick:n=>g(t.product._id,t.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1})]),_:1})]),_:1}))}};export{G as default};
