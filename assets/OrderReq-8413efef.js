import{M as S,N,L as $,x as f,o as v,A,Q as g,S as D,T as n,a6 as R,c as a,R as x,a1 as u,V as T,J as d,$ as C,a5 as b}from"./index-71158f2c.js";import{V as I,a as _}from"./VCol-784b7480.js";import{V as L}from"./VDivider-a357f24b.js";import{V as M}from"./VDataTable-bf42c6cb.js";import"./VList-4574bd2f.js";import"./VListItem-f7aa5f26.js";import"./ssrBoot-968d77d3.js";import"./VMenu-6f37ad5e.js";const E=b("h1",null,"訂單請求",-1),J={key:0},O={key:1,class:"text-red text-decoration-line-through"},X={__name:"OrderReq",setup(Q){const{apiAuth:p}=R(),l=S(),m=N(),y=$(),s=f([]),V=[{title:"商品名稱",key:"product.name"},{title:"圖片",key:"product.image"},{title:"賣家",key:"product.account"},{title:"單價",key:"product.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:e=>e.product.price*e.quantity},{title:"操作",key:"action"}],B=v(()=>s.value.reduce((e,o)=>e+o.quantity*o.product.price,0)),w=v(()=>s.value.length>0&&!s.value.some(e=>!e.product.sell)),h=async(e,o)=>{var t,c;if(!m.isLogin){y.push("/login");return}try{const{data:r}=await p.patch("/users/cart",{product:e,quantity:o});m.cart=r.result,l({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}});const i=s.value.findIndex(P=>P.product._id===e);s.value[i].quantity+=o,s.value[i].quantity<=0&&s.value.splice(i,1)}catch(r){console.log(r);const i=((c=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:c.message)||"發生錯誤，請稍後再試";l({text:i,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},k=f(!1),q=async()=>{var e,o;k.value=!0;try{await p.post("/orders"),m.cart=0,y.push("/orders"),l({text:"結帳成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(t){console.log(t);const c=((o=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";l({text:c,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}k.value=!1};return A(async()=>{var e,o;try{const{data:t}=await p.get("/users/cart");s.value.push(...t.result)}catch(t){console.log(t);const c=((o=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";l({text:c,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),(e,o)=>(g(),D(I,null,{default:n(()=>[a(_,{cols:"12"},{default:n(()=>[E]),_:1}),a(L),a(_,{cols:"12"},{default:n(()=>[a(M,{items:s.value,headers:V},{"item.product.name":n(({item:t})=>[t.product.sell?(g(),x("span",J,u(t.product.name),1)):(g(),x("span",O,u(t.product.name)+" (已下架)",1))]),"item.product.image":n(({item:t})=>[a(T,{src:t.product.image,height:"50px"},null,8,["src"])]),"item.quantity":n(({item:t})=>[a(d,{variant:"text",icon:"mdi-minus",color:"red",onClick:c=>h(t.product._id,-1)},null,8,["onClick"]),C(u(t.quantity),1),a(d,{variant:"text",icon:"mdi-plus",color:"green",onClick:c=>h(t.product._id,1)},null,8,["onClick"])]),"item.action":n(({item:t})=>[a(d,{variant:"text",icon:"mdi-delete",color:"red",onClick:c=>h(t.product._id,t.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),a(_,{class:"text-center",cols:"12"},{default:n(()=>[b("p",null,"總金額: "+u(B.value),1),a(d,{color:"green",disabled:!w.value,loading:k.value,onClick:q},{default:n(()=>[C("結帳")]),_:1},8,["disabled","loading"])]),_:1})]),_:1}))}};export{X as default};
